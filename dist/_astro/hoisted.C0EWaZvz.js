function G(e){return e.replace(".png","").split("_").map(r=>r.charAt(0).toUpperCase()+r.slice(1)).join(" ")}function U(e){return e.includes("ore")?"ore":e.includes("planks")||e.includes("log")||e.includes("wood")?"wood":e.includes("nether")||e.includes("soul")||e.includes("glowstone")?"nether":e.includes("end")||e.includes("purpur")?"end":e.includes("dirt")||e.includes("grass")||e.includes("mycelium")||e.includes("sand")?"natural":e.includes("stone")||e.includes("granite")||e.includes("diorite")||e.includes("andesite")||e.includes("deepslate")||e.includes("obsidian")||e.includes("bedrock")||e.includes("brick")?"stone":e.includes("door")||e.includes("trapdoor")||e.includes("fence")||e.includes("stairs")||e.includes("slab")?"building":e.includes("wool")||e.includes("carpet")||e.includes("concrete")||e.includes("terracotta")?"decoration":"other"}let E=[],u=[],I=600,f={width:2560,height:1440},x="png";const C=new Map;let B=!1,L=!1,A="all",p=[];const P=document.getElementById("textureGrid"),d=document.getElementById("previewCanvas"),w=d.getContext("2d"),X=document.getElementById("scaleSlider"),_=document.getElementById("scaleValue"),k=document.getElementById("searchInput"),T=document.querySelectorAll(".category-btn"),z=document.querySelectorAll(".resolution-btn"),F=document.querySelectorAll(".format-btn"),Y=document.getElementById("downloadMainBtn"),$=document.getElementById("loadingIndicator"),D=document.getElementById("searchContainer"),V=document.getElementById("categoryContainer"),H=document.getElementById("textureCount"),j=document.getElementById("visibleCount"),O=document.getElementById("totalCount"),J=document.getElementById("resetBtn");d.width=960;d.height=540;async function K(){try{E=(await(await fetch("/api/textures")).json()).map(r=>{const n=r.replace(".png","");return{id:n,name:G(r),category:U(n),image:`/textures/${r}`}}),O.textContent=E.length.toString(),Q(),$.classList.add("hidden"),D.classList.remove("hidden"),V.classList.remove("hidden"),H.classList.remove("hidden"),T[0].click()}catch(e){console.error("Error loading textures:",e),$.textContent="Error loading textures. Make sure textures are in public/textures/"}}function Q(){P.innerHTML="";let e=0;E.forEach(t=>{const r=document.createElement("button");r.className="texture-item aspect-square bg-minecraft-dark hover:border-minecraft-green border-2 border-transparent rounded cursor-pointer transition-all relative group overflow-visible",r.setAttribute("data-texture-id",t.id),r.setAttribute("data-category",t.category);const n=document.createElement("img");n.src=t.image,n.alt=t.name,n.className="w-full h-full object-cover p-1 pixelated",n.style.imageRendering="pixelated";const a=document.createElement("div");a.className="fixed bg-black bg-opacity-95 border border-minecraft-green px-3 py-1.5 rounded opacity-0 transition-opacity pointer-events-none whitespace-nowrap z-50 text-sm text-white",a.textContent=t.name,a.style.display="none",r.addEventListener("mouseenter",o=>{const c=r.getBoundingClientRect();a.style.left=`${c.left+c.width/2}px`,a.style.top=`${c.bottom+8}px`,a.style.transform="translateX(-50%)",a.style.display="block",document.body.appendChild(a),setTimeout(()=>a.style.opacity="1",10)}),r.addEventListener("mouseleave",()=>{a.style.opacity="0",setTimeout(()=>{a.parentNode&&a.remove()},200)});const s=document.createElement("div");s.className="selected-indicator hidden absolute inset-0 minecraft-border rounded pointer-events-none",r.appendChild(n),r.appendChild(s),r.addEventListener("click",()=>{u.includes(t.id)?(u=u.filter(o=>o!==t.id),s.classList.add("hidden"),r.classList.remove("border-minecraft-green")):(u.push(t.id),s.classList.remove("hidden"),r.classList.add("border-minecraft-green")),W(),S()}),P.appendChild(r),e++}),j.textContent=e.toString()}function M(){const e=k.value.toLowerCase(),t=document.querySelectorAll(".texture-item");let r=0;t.forEach(n=>{const a=n.getAttribute("data-texture-id"),s=E.find(b=>b.id===a),o=n.getAttribute("data-category");(s?.name.toLowerCase().includes(e)||a.includes(e))&&(A==="all"||o===A)?(n.style.display="",r++):n.style.display="none"}),j.textContent=r.toString()}J.addEventListener("click",()=>{u=[],k.value="",document.querySelectorAll(".texture-item").forEach(t=>{t.querySelector(".selected-indicator").classList.add("hidden"),t.classList.remove("border-minecraft-green")}),M(),p=[],S()});k.addEventListener("input",M);T.forEach(e=>{e.addEventListener("click",()=>{A=e.getAttribute("data-category"),T.forEach(t=>{t.classList.remove("minecraft-border"),t.classList.add("border-gray-600")}),e.classList.add("minecraft-border"),e.classList.remove("border-gray-600"),M()})});X.addEventListener("input",e=>{I=parseInt(e.target.value),_.textContent=I.toString(),S()});z.forEach(e=>{e.addEventListener("click",()=>{const t=parseInt(e.getAttribute("data-width")),r=parseInt(e.getAttribute("data-height"));f={width:t,height:r},z.forEach(n=>{n.classList.remove("minecraft-border"),n.classList.add("border-gray-600")}),e.classList.add("minecraft-border"),e.classList.remove("border-gray-600")})});F.forEach(e=>{e.addEventListener("click",()=>{x=e.getAttribute("data-format"),F.forEach(t=>{t.classList.remove("minecraft-border"),t.classList.add("border-gray-600")}),e.classList.add("minecraft-border"),e.classList.remove("border-gray-600")})});async function q(e){return C.has(e)?C.get(e):new Promise((t,r)=>{const n=new Image;n.crossOrigin="anonymous",n.onload=()=>{C.set(e,n),t(n)},n.onerror=()=>{const s=document.createElement("canvas");s.width=16,s.height=16;const o=s.getContext("2d"),c={stone:"#7F7F7F",cobblestone:"#828282",mossy_cobblestone:"#6B826B",stone_bricks:"#7A7A7A",deepslate:"#4A4A4A",obsidian:"#0F0621",bedrock:"#565656",netherrack:"#6B3333",end_stone:"#E3E8A0"};o.fillStyle=c[e]||"#7F7F7F",o.fillRect(0,0,16,16);const l=new Image;l.src=s.toDataURL(),l.onload=()=>{C.set(e,l),t(l)}};const a=E.find(s=>s.id===e);n.src=a?.image||`/textures/${e}.png`})}function W(){if(u.length===0){p=[];return}const e=Math.ceil(7680/16)+1,t=Math.ceil(4320/16)+1,r=e*t;p=[];for(let n=0;n<r;n++)p.push(Math.floor(Math.random()*u.length))}async function S(){if(u.length===0){w.clearRect(0,0,d.width,d.height);return}if(B){L=!0;return}B=!0,L=!1;const e=[...u],t=[...p];try{const r=await Promise.all(e.map(i=>q(i)));if(r.length===0){w.clearRect(0,0,d.width,d.height);return}const n=document.createElement("canvas");n.width=f.width,n.height=f.height;const a=n.getContext("2d"),o=Math.max(1,Math.floor(16*I/100)),c=Math.ceil(n.width/o)+1,l=Math.ceil(n.height/o)+1,b=c*l,h=t.length>0&&t.every(i=>i>=0&&i<r.length)?t:Array.from({length:b},()=>Math.floor(Math.random()*r.length));h!==t&&(p=h),a.clearRect(0,0,n.width,n.height);let g=0;for(let i=0;i<l;i++)for(let v=0;v<c;v++){const m=h[g%h.length]??0,y=r[m]??r[0];if(!y){g++;continue}a.imageSmoothingEnabled=!1,a.drawImage(y,v*o,i*o,o,o),g++}w.clearRect(0,0,d.width,d.height),w.imageSmoothingEnabled=!0,w.drawImage(n,0,0,d.width,d.height)}finally{B=!1,L&&(L=!1,S())}}Y.addEventListener("click",async()=>{if(u.length===0){alert("Please select at least one texture");return}const e=document.createElement("canvas");e.width=f.width,e.height=f.height;const t=e.getContext("2d"),r=[...u],n=[...p],a=await Promise.all(r.map(m=>q(m)));if(a.length===0){alert("Could not load the selected textures");return}const o=Math.floor(16*I/100),c=Math.ceil(e.width/o)+1,l=Math.ceil(e.height/o)+1;t.clearRect(0,0,e.width,e.height),x==="jpg"&&(t.fillStyle="#000000",t.fillRect(0,0,e.width,e.height));const b=c*l,h=n.length>0&&n.every(m=>m>=0&&m<a.length)?n:Array.from({length:b},()=>Math.floor(Math.random()*a.length));let g=0;for(let m=0;m<l;m++)for(let y=0;y<c;y++){const N=h[g%h.length]??0,R=a[N]??a[0];if(!R){g++;continue}t.imageSmoothingEnabled=!1,t.drawImage(R,y*o,m*o,o,o),g++}const i=document.createElement("a"),v=x==="jpg"?"image/jpeg":`image/${x}`;i.download=`minecraft-wallpaper-${f.width}x${f.height}.${x}`,i.href=e.toDataURL(v,.95),i.click()});K();
